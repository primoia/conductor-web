<!--
  ‚úÖ Normalizado seguindo especifica√ß√£o de modais padr√£o v1.0
  ‚úÖ Usa *ngIf="isVisible" para controle de visibilidade
  ‚úÖ Usa onBackdropClick com stopPropagation inline no container
  ‚úÖ Implementa acessibilidade (ARIA, roles)
-->
<div class="modal-backdrop"
     *ngIf="isVisible"
     (click)="onBackdropClick($event)"
     role="dialog"
     aria-modal="true"
     aria-labelledby="report-modal-title">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <!-- Header reutiliz√°vel -->
    <app-modal-header
      id="report-modal-title"
      title="Relat√≥rio do Conselheiro"
      icon="fas fa-chart-bar"
      [subtitle]="councilorName"
      [showCloseButton]="true"
      (close)="onClose()">
    </app-modal-header>

    <!-- Body -->
    <div class="modal-body" *ngIf="report">
      <!-- Estat√≠sticas Gerais -->
      <div class="stats-section">
        <div class="stat-card">
          <div class="stat-icon">üéØ</div>
          <div class="stat-content">
            <div class="stat-value">{{ report.total_executions || 0 }}</div>
            <div class="stat-label">Total de Execu√ß√µes</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-content">
            <div class="stat-value">{{ report.success_rate || 0 }}%</div>
            <div class="stat-label">Taxa de Sucesso</div>
          </div>
        </div>

        <div class="stat-card" *ngIf="report.next_execution">
          <div class="stat-icon">‚è∞</div>
          <div class="stat-content">
            <div class="stat-value">{{ formatDate(report.next_execution) }}</div>
            <div class="stat-label">Pr√≥xima Execu√ß√£o</div>
          </div>
        </div>
      </div>

      <!-- Execu√ß√µes Recentes -->
      <div class="executions-section">
        <h3>Execu√ß√µes Recentes</h3>

        <div *ngIf="!report.recent_executions || report.recent_executions.length === 0" class="empty-state">
          <p>Nenhuma execu√ß√£o registrada ainda.</p>
        </div>

        <div class="executions-list" *ngIf="report.recent_executions && report.recent_executions.length > 0">
          <div
            *ngFor="let execution of report.recent_executions"
            class="execution-item"
            [ngClass]="getSeverityClass(execution.severity)"
          >
            <!-- Execution Header -->
            <div class="execution-header">
              <div class="execution-info">
                <span class="severity-badge" [ngClass]="getSeverityClass(execution.severity)">
                  {{ getSeverityEmoji(execution.severity) }}
                  {{ getSeverityLabel(execution.severity) }}
                </span>
                <span class="status-badge" [ngClass]="getStatusClass(execution.status)">
                  {{ getStatusLabel(execution.status) }}
                </span>
              </div>
              <div class="execution-meta">
                <span class="execution-date">{{ formatDate(execution.started_at) }}</span>
                <span class="execution-duration" *ngIf="execution.duration_ms">
                  ‚è±Ô∏è {{ formatDuration(execution.duration_ms) }}
                </span>
              </div>
            </div>

            <!-- Execution Output -->
            <div class="execution-output" *ngIf="execution.output">
              <pre>{{ execution.output }}</pre>
            </div>

            <!-- Execution Error -->
            <div class="execution-error" *ngIf="execution.error">
              <strong>Erro:</strong>
              <pre>{{ execution.error }}</pre>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div class="modal-body loading-state" *ngIf="!report">
      <div class="spinner"></div>
      <p>Carregando relat√≥rio...</p>
    </div>

    <!-- Footer reutiliz√°vel -->
    <app-modal-footer
      [buttons]="footerButtons"
      (buttonClick)="handleFooterAction($event)">
    </app-modal-footer>
  </div>
</div>
