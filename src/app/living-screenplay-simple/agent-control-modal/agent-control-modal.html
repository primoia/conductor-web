<!--
  Agent Control Modal Template
  ‚úÖ Normalizado seguindo especifica√ß√£o de modais padr√£o v1.0
  ‚úÖ Usa BaseModalComponent para comportamentos consistentes
  ‚úÖ ARIA compliant (WCAG 2.1 AA)
-->
<div *ngIf="isVisible && agent" class="modal-backdrop" (click)="onBackdropClick($event)"
     role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-description">
  <div class="modal-container" (click)="$event.stopPropagation()">

    <!-- Modal Header usando componente base -->
    <app-modal-header
      [title]="getModalTitle()"
      [showCloseButton]="true"
      [ariaLabelledBy]="'modal-title'"
      (close)="onClose()">
    </app-modal-header>

    <!-- Modal Body -->
    <div class="modal-body">
      <div class="agent-info">
        <p><strong>Descri√ß√£o:</strong> {{ agent.definition.description }}</p>
        <p>
          <strong>Status:</strong>
          <span [class]="'status-badge status-' + agent.status">
            {{ getStatusText(agent.status) }}
          </span>
        </p>
      </div>

      <!-- Content based on agent status -->
      <ng-container [ngSwitch]="agent.status">

        <!-- Estado: Pendente -->
        <div *ngSwitchCase="'pending'" class="state-content">
          <div class="prompt-input">
            <label for="agent-prompt"><strong>Prompt para o agente:</strong></label>
            <textarea
              id="agent-prompt"
              [value]="agentPrompt"
              (input)="onPromptInput($event)"
              class="prompt-textarea"
              placeholder="Digite o que voc√™ quer que o agente fa√ßa... (ex: 'Analise a performance da aplica√ß√£o e sugira melhorias')"
              aria-label="Prompt para o agente">
            </textarea>
          </div>
        </div>

        <!-- Estado: Em Fila -->
        <div *ngSwitchCase="'queued'" class="state-content execution-info">
          <div class="status-icon">‚è≥</div>
          <h4>Agente na Fila</h4>
          <p>O agente est√° aguardando na fila de execu√ß√£o.</p>
          <div class="logs-container" *ngIf="executionLogs.length > 0" role="log" aria-live="polite">
            <div *ngFor="let log of executionLogs" class="log-entry">
              {{ log }}
            </div>
          </div>
        </div>

        <!-- Estado: Executando -->
        <div *ngSwitchCase="'running'" class="state-content execution-info">
          <div class="status-icon">‚ö°</div>
          <h4>Executando Agente</h4>
          <p>O agente est√° sendo executado agora...</p>
          <div class="logs-container" *ngIf="executionLogs.length > 0" role="log" aria-live="polite">
            <div *ngFor="let log of executionLogs" class="log-entry">
              {{ log }}
            </div>
          </div>
        </div>

        <!-- Estado: Conclu√≠do -->
        <div *ngSwitchCase="'completed'" class="state-content completion-info">
          <div class="status-icon">‚úÖ</div>
          <h4>Execu√ß√£o Conclu√≠da</h4>
          <p>O agente foi executado com sucesso!</p>

          <!-- Show result if available -->
          <div class="result-container" *ngIf="agent.executionState?.result">
            <h5>üìã Resultado:</h5>
            <div class="result-content">
              {{ getResultDisplay(agent.executionState.result) }}
            </div>
          </div>

          <!-- Show execution logs -->
          <div class="logs-container" *ngIf="executionLogs.length > 0" role="log">
            <h5>üìù Logs de Execu√ß√£o:</h5>
            <div *ngFor="let log of executionLogs" class="log-entry">
              {{ log }}
            </div>
          </div>
        </div>

        <!-- Estado: Erro -->
        <div *ngSwitchCase="'error'" class="state-content error-info">
          <div class="status-icon">‚ùå</div>
          <h4>Erro na Execu√ß√£o</h4>
          <p class="error-message">{{ agent.executionState?.error || 'Erro desconhecido' }}</p>
          <div class="logs-container" *ngIf="executionLogs.length > 0" role="log">
            <div *ngFor="let log of executionLogs" class="log-entry">
              {{ log }}
            </div>
          </div>
        </div>

      </ng-container>
    </div>

    <!-- Modal Footer usando componente base -->
    <app-modal-footer
      [buttons]="getFooterActions()"
      (buttonClick)="onFooterAction($event)">
    </app-modal-footer>
  </div>
</div>
