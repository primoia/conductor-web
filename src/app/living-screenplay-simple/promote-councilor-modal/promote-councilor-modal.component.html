<!--
  ============================================================
  MODAL: Promote Councilor Modal
  ============================================================
  Estado de Normaliza√ß√£o:
  ‚úì Extends BaseModalComponent
  ‚úì Usa isVisible para controle de exibi√ß√£o
  ‚úì Usa closeModal como output padr√£o
  ‚úì Implementa onClose() override
  ‚úì Implementa onBackdropClick() override
  ‚úì Usa classes .modal-backdrop e .modal-container
  ‚úì Usa *ngIf="isVisible" no backdrop
  ‚úì Usa (click)="onBackdropClick($event)" no backdrop
  ‚úì Usa (click)="$event.stopPropagation()" inline no container
  ‚úì Usa mixins SCSS padronizados

  Data: 2025-11-08
  ============================================================
-->
<div class="modal-backdrop" *ngIf="isVisible" (click)="onBackdropClick($event)">
  <div class="modal-container" (click)="$event.stopPropagation()" role="dialog" aria-modal="true" aria-labelledby="modal-title">

    <app-modal-header
      [title]="'‚≠ê Promover Agente a Conselheiro'"
      [showCloseButton]="true"
      (closeClick)="onClose()"
      aria-label="Cabe√ßalho do modal de promo√ß√£o">
    </app-modal-header>

    <!-- Body -->
    <div class="modal-body">
      <!-- Informa√ß√µes do Agente -->
      <div class="agent-info" *ngIf="agent">
        <div class="agent-badge">
          <span class="agent-emoji">{{ agent.emoji }}</span>
          <div class="agent-details">
            <strong>{{ agent.name }}</strong>
            <small>{{ agent.description }}</small>
          </div>
        </div>
      </div>

      <form class="promote-form">
        <!-- Se√ß√£o: Personaliza√ß√£o -->
        <section class="form-section">
          <h3>üë§ Personaliza√ß√£o do Conselheiro</h3>

          <div class="form-group">
            <label for="displayName">Nome do Conselheiro *</label>
            <input
              type="text"
              id="displayName"
              [(ngModel)]="displayName"
              name="displayName"
              placeholder="Ex: Silva, Maria, Jo√£o"
              required
            />
            <small class="hint">Nome usado nas notifica√ß√µes e relat√≥rios</small>
          </div>

          <div class="form-group">
            <label for="title">T√≠tulo/Cargo *</label>
            <input
              type="text"
              id="title"
              [(ngModel)]="title"
              name="title"
              placeholder="Ex: Conselheiro de Qualidade, Conselheiro de Arquitetura"
              required
            />
          </div>
        </section>

        <!-- Se√ß√£o: Tarefa Autom√°tica -->
        <section class="form-section">
          <h3>üìã Tarefa Autom√°tica</h3>

          <!-- Seletor de Template -->
          <div class="form-group">
            <label for="template">Template de Tarefa (Opcional)</label>
            <select
              id="template"
              (change)="applyTemplate($any($event.target).value)"
              name="template"
            >
              <option value="">-- Selecione um template --</option>
              <option *ngFor="let key of templateKeys" [value]="key">
                {{ getTemplateName(key) }}
              </option>
            </select>
            <small class="hint">Escolha um template pr√©-configurado ou crie do zero</small>
          </div>

          <div class="form-group">
            <label for="taskName">Nome da Tarefa *</label>
            <input
              type="text"
              id="taskName"
              [(ngModel)]="taskName"
              name="taskName"
              placeholder="Ex: Verificar Arquivos Monol√≠ticos"
              required
            />
          </div>

          <div class="form-group">
            <label for="taskPrompt">Descri√ß√£o/Prompt da Tarefa *</label>
            <textarea
              id="taskPrompt"
              [(ngModel)]="taskPrompt"
              name="taskPrompt"
              rows="8"
              placeholder="Descreva o que o conselheiro deve fazer...

Exemplo:
Analise todos os arquivos .ts do projeto.
Identifique arquivos com mais de 500 linhas.
Retorne lista com sugest√µes de refatora√ß√£o."
              required
            ></textarea>
            <small class="hint">Este prompt ser√° executado periodicamente pelo conselheiro</small>
          </div>

          <!-- Arquivos de Contexto -->
          <div class="form-group">
            <label>Arquivos de Contexto (Opcional)</label>
            <div class="context-files-list">
              <div class="context-file-item" *ngFor="let file of contextFiles; let i = index">
                <span>{{ file }}</span>
                <button type="button" class="remove-btn" (click)="removeContextFile(i)">√ó</button>
              </div>
              <div class="add-context-file">
                <input
                  type="text"
                  [(ngModel)]="newContextFile"
                  name="newContextFile"
                  placeholder="Ex: docs/guidelines.md"
                  (keyup.enter)="addContextFile()"
                />
                <button type="button" class="add-btn" (click)="addContextFile()">+ Adicionar</button>
              </div>
            </div>
            <small class="hint">Arquivos que ser√£o inclu√≠dos no contexto da execu√ß√£o</small>
          </div>
        </section>

        <!-- Se√ß√£o: Periodicidade -->
        <section class="form-section">
          <h3>‚è∞ Periodicidade</h3>

          <div class="schedule-type-selector">
            <label class="radio-option">
              <input
                type="radio"
                name="scheduleType"
                value="interval"
                [(ngModel)]="scheduleType"
              />
              <span>Intervalo</span>
            </label>
            <label class="radio-option">
              <input
                type="radio"
                name="scheduleType"
                value="cron"
                [(ngModel)]="scheduleType"
              />
              <span>Cron (Avan√ßado)</span>
            </label>
          </div>

          <!-- Intervalo -->
          <div class="form-group" *ngIf="scheduleType === 'interval'">
            <label>A cada:</label>
            <div class="interval-input">
              <input
                type="number"
                [(ngModel)]="intervalValue"
                name="intervalValue"
                min="1"
                max="999"
              />
              <select [(ngModel)]="intervalUnit" name="intervalUnit">
                <option value="m">minutos</option>
                <option value="h">horas</option>
                <option value="d">dias</option>
              </select>
            </div>
          </div>

          <!-- Cron -->
          <div class="form-group" *ngIf="scheduleType === 'cron'">
            <label for="cronValue">Express√£o Cron</label>
            <input
              type="text"
              id="cronValue"
              [(ngModel)]="cronValue"
              name="cronValue"
              placeholder="0 9 * * 1"
            />
            <small class="hint">Formato: minuto hora dia m√™s dia-da-semana (ex: "0 9 * * 1" = segunda 9h)</small>
          </div>

          <!-- Preview do agendamento -->
          <div class="schedule-preview">
            <strong>Agendamento:</strong> {{ getScheduleDescription() }}
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input
                type="checkbox"
                [(ngModel)]="scheduleEnabled"
                name="scheduleEnabled"
              />
              <span>Ativar agendamento imediatamente</span>
            </label>
          </div>
        </section>

        <!-- Se√ß√£o: Notifica√ß√µes -->
        <section class="form-section">
          <h3>üîî Notifica√ß√µes</h3>

          <div class="form-group">
            <label>Notificar quando:</label>
            <label class="checkbox-label">
              <input
                type="checkbox"
                [(ngModel)]="notifyOnError"
                name="notifyOnError"
              />
              <span>Erros ou problemas cr√≠ticos</span>
            </label>
            <label class="checkbox-label">
              <input
                type="checkbox"
                [(ngModel)]="notifyOnWarning"
                name="notifyOnWarning"
              />
              <span>Alertas ou avisos</span>
            </label>
            <label class="checkbox-label">
              <input
                type="checkbox"
                [(ngModel)]="notifyOnSuccess"
                name="notifyOnSuccess"
              />
              <span>Sucesso (sem problemas encontrados)</span>
            </label>
          </div>

          <div class="form-group">
            <label>Onde notificar:</label>
            <label class="checkbox-label">
              <input
                type="checkbox"
                [(ngModel)]="notifyPanel"
                name="notifyPanel"
              />
              <span>Painel de Eventos (recomendado)</span>
            </label>
            <label class="checkbox-label">
              <input
                type="checkbox"
                [(ngModel)]="notifyToast"
                name="notifyToast"
              />
              <span>Notifica√ß√µes Toast</span>
            </label>
            <label class="checkbox-label">
              <input
                type="checkbox"
                [(ngModel)]="notifyEmail"
                name="notifyEmail"
                disabled
              />
              <span>Email (em breve)</span>
            </label>
          </div>
        </section>
      </form>
    </div>

    <!-- Footer -->
    <app-modal-footer
      [buttons]="footerButtons"
      (buttonClick)="handleFooterAction($event)"
      aria-label="A√ß√µes do modal">
    </app-modal-footer>

  </div>
</div>
