<div class="dashboard-backdrop" (click)="onClose()">
  <div class="dashboard-container" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="dashboard-header">
      <div class="header-content">
        <h2>üèõÔ∏è Conselho Municipal</h2>
        <p class="subtitle">Conselheiros ativos monitorando o projeto</p>
      </div>
      <button class="close-btn" (click)="onClose()" title="Fechar">√ó</button>
    </div>

    <!-- Body -->
    <div class="dashboard-body">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-state">
        <div class="spinner"></div>
        <p>Carregando conselheiros...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="errorMessage" class="error-state">
        <p>‚ùå {{ errorMessage }}</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && councilors.length === 0" class="empty-state">
        <div class="empty-icon">üèõÔ∏è</div>
        <h3>Nenhum conselheiro ativo</h3>
        <p>Promova um agente para conselheiro e configure tarefas autom√°ticas de monitoramento.</p>
        <button class="btn btn-primary" (click)="onPromoteNew()">
          ‚≠ê Promover Primeiro Conselheiro
        </button>
      </div>

      <!-- Councilors List -->
      <div *ngIf="!isLoading && councilors.length > 0" class="councilors-list">
        <div
          *ngFor="let councilor of councilors"
          class="councilor-card"
          [ngClass]="getStatusClass(councilor)"
        >
          <!-- Card Header -->
          <div class="card-header">
            <div class="councilor-info">
              <div class="councilor-avatar">
                <span class="avatar-emoji">{{ councilor.emoji }}</span>
                <span class="status-badge">{{ getStatusEmoji(councilor) }}</span>
              </div>
              <div class="councilor-details">
                <h3>{{ councilor.customization?.display_name || councilor.name }}</h3>
                <p class="role">{{ councilor.councilor_config?.title }}</p>
              </div>
            </div>
            <div class="card-actions">
              <button
                class="icon-btn"
                (click)="viewLastReport(councilor)"
                title="Ver √öltimo Relat√≥rio"
              >
                üìã
              </button>
              <button
                class="icon-btn"
                (click)="editCouncilor(councilor)"
                title="Editar Configura√ß√£o"
              >
                ‚öôÔ∏è
              </button>
              <button
                *ngIf="councilor.councilor_config && councilor.councilor_config.schedule && councilor.councilor_config.schedule.enabled"
                class="icon-btn"
                (click)="pauseCouncilor(councilor)"
                title="Pausar"
              >
                ‚è∏Ô∏è
              </button>
              <button
                *ngIf="councilor.councilor_config && councilor.councilor_config.schedule && !councilor.councilor_config.schedule.enabled"
                class="icon-btn"
                (click)="resumeCouncilor(councilor)"
                title="Retomar"
              >
                ‚ñ∂Ô∏è
              </button>
            </div>
          </div>

          <!-- Card Body -->
          <div class="card-body">
            <!-- Task Info -->
            <div class="task-info">
              <div class="info-item">
                <span class="label">Tarefa:</span>
                <span class="value">{{ councilor.councilor_config?.task?.name || 'N/A' }}</span>
              </div>
              <div class="info-item">
                <span class="label">√öltima execu√ß√£o:</span>
                <span class="value">
                  {{ formatRelativeTime(councilor.stats?.last_execution) }}
                </span>
              </div>
              <div class="info-item">
                <span class="label">Pr√≥xima execu√ß√£o:</span>
                <span class="value">{{ getNextExecution(councilor) }}</span>
              </div>
            </div>

            <!-- Stats -->
            <div class="stats-row">
              <div class="stat-item">
                <div class="stat-value">{{ councilor.stats?.total_executions || 0 }}</div>
                <div class="stat-label">Execu√ß√µes</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">{{ councilor.stats?.success_rate || 0 }}%</div>
                <div class="stat-label">Taxa de Sucesso</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">
                  {{ councilor.councilor_config?.schedule?.value || 'N/A' }}
                </div>
                <div class="stat-label">Intervalo</div>
              </div>
            </div>
          </div>

          <!-- Card Footer -->
          <div class="card-footer">
            <button class="btn-text btn-danger" (click)="demoteCouncilor(councilor)">
              Remover do Conselho
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="dashboard-footer">
      <div class="footer-info">
        <span>{{ councilors.length }} conselheiro(s) ativo(s)</span>
      </div>
      <button class="btn btn-secondary" (click)="onPromoteNew()">
        ‚≠ê Promover Novo Conselheiro
      </button>
    </div>

    <!-- Modals -->
    <app-councilor-report-modal
      *ngIf="showReportModal"
      [report]="selectedReport"
      [councilorName]="selectedCouncilor?.customization?.display_name || selectedCouncilor?.name || ''"
      (close)="closeReportModal()"
    ></app-councilor-report-modal>

    <app-councilor-edit-modal
      *ngIf="showEditModal"
      [councilor]="selectedCouncilor"
      (close)="closeEditModal()"
      (save)="saveCouncilorConfig($event)"
    ></app-councilor-edit-modal>
  </div>
</div>
